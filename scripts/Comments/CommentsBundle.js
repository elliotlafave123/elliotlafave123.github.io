(()=>{"use strict";const t={fullName:void 0,emailAddress:void 0,emailVerified:void 0,id:void 0,profileImgColor:void 0};var e=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function c(t){try{d(o.next(t))}catch(t){a(t)}}function l(t){try{d(o.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,l)}d((o=o.apply(t,e||[])).next())}))};const n="https://elliotapiserver.co.uk/Comments";let o=localStorage.getItem("token");function i(){let t=document.querySelectorAll(".editLinkButton");t.length>0&&t.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),a(t)}))}))}const a=t=>{var e;if(null!==t.closest(".comment")){let n=t.closest("div.comment-main").querySelector(".editComment");if(n&&"none"===n.style.display){t.innerText="Cancel Editing",n.style.display="block";const o=null===(e=t.closest("div.comment-main"))||void 0===e?void 0:e.querySelector("p");let i=o.innerText;i&&(t.closest("div.comment-header").insertAdjacentHTML("afterend",'\n                    <textarea \n                        name="commentTextarea" \n                        class="commentTextarea" \n                        minlength="3"\n                        maxlength="120"\n                        requiredminlength="3"\n\t\t\t\t\t\tmaxlength="120"\n\t\t\t\t\t\trequired\n                    ></textarea>\n                '),o.style.display="none"),t.closest("div.comment-main").querySelector("textarea").value=i;const a=t.closest("div.comment-main").querySelector(".deleteLinkButton"),l=t.closest("div.comment-main").querySelector(".publish");let d=t.closest(".comment"),s=null==d?void 0:d.dataset.commentid,r=document.getElementById("commentStreamContainer"),m=null==r?void 0:r.dataset.stream;a&&l&&void 0!==s&&void 0!==m&&c(a,l,s,m,t)}else{const e=t.closest("div.comment-main").querySelector("p");t.innerText="Edit Comment",e.style.display="block",t.closest("div.comment-main").querySelector("textarea").remove(),n.style.display="none"}}};i();const c=(t,n,o,i,a)=>{t.addEventListener("click",(t=>e(void 0,void 0,void 0,(function*(){t.preventDefault(),yield l(o,i)})))),n.addEventListener("click",(t=>e(void 0,void 0,void 0,(function*(){t.preventDefault(),yield d(o,a)}))))},l=(t,i)=>e(void 0,void 0,void 0,(function*(){let e={token:o,commentStreamId:i};204===(yield fetch(n+"?"+new URLSearchParams({id:t}).toString(),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status&&v()})),d=(t,i)=>e(void 0,void 0,void 0,(function*(){let e={token:o,id:t,text:i.closest("div.comment-main").querySelector("textarea").value};201===(yield fetch(n+"?"+new URLSearchParams({id:t}).toString(),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status&&v()}));var s=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function c(t){try{d(o.next(t))}catch(t){a(t)}}function l(t){try{d(o.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,l)}d((o=o.apply(t,e||[])).next())}))};const r="https://elliotapiserver.co.uk/Comments/vote";let m=localStorage.getItem("token");var u=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function c(t){try{d(o.next(t))}catch(t){a(t)}}function l(t){try{d(o.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,l)}d((o=o.apply(t,e||[])).next())}))};function v(){return u(this,void 0,void 0,(function*(){try{const t=yield fetch("https://elliotapiserver.co.uk/Comments?"+new URLSearchParams({stream:"633d4dbc76066edc99546269"}).toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(200!==t.status)throw new Error("Not Authenticated");{const e=yield t.json();e.length>0&&f(e)}}catch(t){}}))}localStorage.getItem("token");const f=e=>{const n=document.getElementById("InsertCommentsContainer");n&&(n.innerHTML="",e.forEach((e=>u(void 0,void 0,void 0,(function*(){let o=`\n        <div class="comment" data-commentId="${e.id}">\n        <div class="comment-main">\n            <div class="comment-header">\n                <div>\n                    <img src="../../../../img/logo-dark.png" alt="Profile Image" />\n                    <div class="CommentHeaderDot"></div>\n                    <h2>${e.fullname}</h2>\n                    <div class="CommentHeaderDot"></div>\n                    <span>${function(t){const e=new Date(t);var n=e.getDate(),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],i=e.getFullYear(),a=e.getHours(),c=e.getMinutes();return`${o} ${n<=9?"0"+n:n}, ${i} at ${a>=12?a-12:a}:${c<=9?"0"+c:c} ${a>=12&&c>0?"PM":"AM"}`}(new Date(e.time))}</span>\n                    <h3>${e.hasBeenEdited?"(Edited)":""}</h3>\n                </div>\n                <div>${t.fullName===e.fullname&&void 0!==t.fullName?'<button class="editLinkButton" tabindex="0">Edit Comment</button>':""}</div>\n            </div>\n            <p>\n                ${e.text}\n            </p>\n\t\t\t${t.fullName===e.fullname&&void 0!==t.fullName?'<div class="editComment" style="display: none">\n\t\t\t<button class="deleteLinkButton u-margin-top-small" tabindex="0">Delete Comment</button>\n\t\t\t<button class="publish">Publish</button>\n\t\t</div>':""}\n            \n        </div>\n        <div class="comment-side">\n            <button class="upvoteComment">\n                <i class="fa-solid fa-chevron-up green"></i>\n            </button>\n            <p>${e.upvotes}</p>\n            <div class="CommentHeaderDot"></div>\n            <p>${e.downvotes}</p>\n            <button class="downvoteComment">\n                <i class="fa-solid fa-chevron-down red"></i>\n            </button>\n        </div>\n    </div>\n        `;n.insertAdjacentHTML("afterbegin",o)})))),i(),function(){const t=document.querySelectorAll(".upvoteComment"),e=document.querySelectorAll(".downvoteComment");t.length>0&&t.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),(t=>{s(void 0,void 0,void 0,(function*(){if(null!==t.closest(".comment")){let e=t.closest(".comment").dataset.commentid,n={token:m,id:e,votetype:"up"};try{200===(yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).status&&v()}catch(t){}}}))})(t)}))})),e.length>0&&e.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),(t=>{s(void 0,void 0,void 0,(function*(){if(null!==t.closest(".comment")){let e=t.closest(".comment").dataset.commentid,n={token:m,id:e,votetype:"down"};try{200===(yield fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).status&&v()}catch(t){}}}))})(t)}))}))}())};const y=document.getElementById("publishCommentButton"),h=document.getElementById("commentStreamContainer"),p=document.getElementById("commentTextarea");let g=localStorage.getItem("token");var S=function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function c(t){try{d(o.next(t))}catch(t){a(t)}}function l(t){try{d(o.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,l)}d((o=o.apply(t,e||[])).next())}))};let w=localStorage.getItem("token");const x=document.getElementById("signedInStrip"),E=document.getElementById("signedInStripWarning"),k=document.getElementById("logOutButton"),C=document.getElementById("verifyEmailButton"),b=()=>S(void 0,void 0,void 0,(function*(){try{const e=yield fetch("https://elliotapiserver.co.uk/Auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:w})});if(201!==e.status)throw C.style.display="none",new Error("Not Authenticated");{const n=yield e.json();t.fullName=n.data.fullName,t.emailAddress=n.data.emailAddress,t.emailVerified=n.data.emailVerified,t.id=n.data.id,t.profileImgColor=n.data.profileImgColor,x&&t.emailVerified?x.style.display="flex":x&&(E.style.display="flex"),function(){var e,n,o,i;e=this,n=void 0,i=function*(){const e=document.querySelector(".add-comment-container-notAllowed");t.emailVerified?null==e||e.classList.add("allowed"):(document.getElementById("logInButton").style.display="none",document.getElementById("signUpButton").style.display="none")},new((o=void 0)||(o=Promise))((function(t,a){function c(t){try{d(i.next(t))}catch(t){a(t)}}function l(t){try{d(i.throw(t))}catch(t){a(t)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,l)}d((i=i.apply(e,n||[])).next())}))}()}}catch(t){}}));k&&k.addEventListener("click",(t=>{t.preventDefault(),S(void 0,void 0,void 0,(function*(){yield fetch("https://elliotapiserver.co.uk/Auth/logout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:w})}),localStorage.setItem("token",""),x&&(x.style.display="none")}))}));!function(){var t,e,n,o;t=this,e=void 0,o=function*(){b(),yield v(),function(){null==y||y.addEventListener("click",(t=>{return e=this,n=void 0,i=function*(){if(t.preventDefault(),""===p.value)return;let e={token:g,text:p.value.toString(),stream:null==h?void 0:h.dataset.stream};try{201===(yield fetch("https://elliotapiserver.co.uk/Comments?"+new URLSearchParams({stream:"633d4dbc76066edc99546269"}).toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).status&&(v(),p.value="")}catch(t){}},new((o=void 0)||(o=Promise))((function(t,a){function c(t){try{d(i.next(t))}catch(t){a(t)}}function l(t){try{d(i.throw(t))}catch(t){a(t)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,l)}d((i=i.apply(e,n||[])).next())}));var e,n,o,i}))}()},new((n=void 0)||(n=Promise))((function(i,a){function c(t){try{d(o.next(t))}catch(t){a(t)}}function l(t){try{d(o.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,l)}d((o=o.apply(t,e||[])).next())}))}()})();